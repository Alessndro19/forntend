<div class="catalogo-page">
  <!-- Hero Section -->
  <section class="hero-section">
    <div class="container">
      <h1 class="display-4 fw-bold mb-4">Descubre Nuestros Vinos Exclusivos</h1>
      <p class="lead mb-5">Explora nuestra cuidada selección de vinos y piscos de las mejores bodegas del Perú. Calidad, tradición y sabor en cada botella.</p>

      <!-- Barra de búsqueda -->
      <div class="search-container">
        <div class="input-group">
          <input type="text"
                 class="form-control search-input"
                 placeholder="Buscar vinos, piscos, marcas..."
                 [ngModel]="filtros.search"
                 (input)="onSearchInput($event)">
          <button class="btn search-btn" type="button">
            <i class="fas fa-search"></i>
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- Catálogo Section -->
  <section class="py-5">
    <div class="container">
      <!-- Toolbar de ordenamiento y resultados -->
      <div class="d-flex justify-content-between align-items-center mb-4 p-3 bg-light rounded">
        <div class="sorting-container">
          <label for="sort-select" class="form-label mb-0 me-2 fw-medium">Ordenar por:</label>
          <select id="sort-select"
                  class="form-select form-select-sm w-auto"
                  [(ngModel)]="filtros.ordenar"
                  (change)="aplicarFiltros()">
            <option *ngFor="let opcion of opcionesOrden" [value]="opcion.valor">
              {{ opcion.texto }}
            </option>
          </select>
        </div>

        <div class="results-count text-muted">
          Mostrando <span class="fw-bold">{{ productosPaginados.length }}</span> de
          <span class="fw-bold">{{ productosFiltrados.length }}</span> productos
        </div>
      </div>

      <div class="row">
        <!-- Sidebar de Filtros -->
        <div class="col-lg-3 mb-4 mb-lg-0">
          <div class="filter-sidebar">
            <div class="filter-header d-flex justify-content-between align-items-center">
              <h2 class="h5 mb-0 fw-bold">FILTROS</h2>
              <button class="btn btn-sm btn-outline-secondary" (click)="limpiarFiltros()">
                Limpiar
              </button>
            </div>

            <!-- Categorías -->
            <div class="filter-group">
              <h3 class="filter-group-title">Categorías</h3>
              <div class="filter-options">
                <div *ngFor="let categoria of categorias" class="form-check filter-option">
                  <input class="form-check-input"
                         type="radio"
                         name="categoria"
                         [value]="categoria"
                         [(ngModel)]="filtros.categoria"
                         (change)="aplicarFiltros()"
                         id="cat-{{categoria}}">
                  <label class="form-check-label" for="cat-{{categoria}}">
                    {{ categoria === 'todos' ? 'Todos los productos' : categoria }}
                  </label>
                </div>
              </div>
            </div>

            <!-- Precio -->
            <div class="filter-group">
              <h3 class="filter-group-title">Rango de Precio</h3>
              <div class="filter-options">
                <div *ngFor="let precio of precios" class="form-check filter-option">
                  <input class="form-check-input"
                         type="radio"
                         name="precio"
                         [value]="precio"
                         [(ngModel)]="filtros.precio"
                         (change)="aplicarFiltros()"
                         id="price-{{precio}}">
                  <label class="form-check-label" for="price-{{precio}}">
                    {{ precio === 'todos' ? 'Todos los precios' : precio }}
                  </label>
                </div>
              </div>
            </div>

            <!-- Marca -->
            <div class="filter-group">
              <h3 class="filter-group-title">Marca</h3>
              <div class="filter-options">
                <div *ngFor="let marca of marcas" class="form-check filter-option">
                  <input class="form-check-input"
                         type="radio"
                         name="marca"
                         [value]="marca"
                         [(ngModel)]="filtros.marca"
                         (change)="aplicarFiltros()"
                         id="brand-{{marca}}">
                  <label class="form-check-label" for="brand-{{marca}}">
                    {{ marca === 'todos' ? 'Todas las marcas' : marca }}
                  </label>
                </div>
              </div>
            </div>

            <!-- Tipo de Uva -->
            <div class="filter-group">
              <h3 class="filter-group-title">Tipo de Uva</h3>
              <div class="filter-options">
                <div *ngFor="let tipoUva of tiposUva" class="form-check filter-option">
                  <input class="form-check-input"
                         type="radio"
                         name="tipoUva"
                         [value]="tipoUva"
                         [(ngModel)]="filtros.tipoUva"
                         (change)="aplicarFiltros()"
                         id="grape-{{tipoUva}}">
                  <label class="form-check-label" for="grape-{{tipoUva}}">
                    {{ tipoUva === 'todos' ? 'Todos los tipos' : tipoUva }}
                  </label>
                </div>
              </div>
            </div>

            <!-- Bodega -->
            <div class="filter-group">
              <h3 class="filter-group-title">Bodega</h3>
              <div class="filter-options">
                <div class="form-check filter-option">
                  <input class="form-check-input"
                         type="radio"
                         name="bodega"
                         value="todos"
                         [(ngModel)]="filtros.bodega"
                         (change)="aplicarFiltros()"
                         id="winery-all">
                  <label class="form-check-label" for="winery-all">
                    Todas las bodegas
                  </label>
                </div>
                <div *ngFor="let bodega of bodegas" class="form-check filter-option">
                  <input class="form-check-input"
                         type="radio"
                         name="bodega"
                         [value]="bodega"
                         [(ngModel)]="filtros.bodega"
                         (change)="aplicarFiltros()"
                         id="winery-{{bodega}}">
                  <label class="form-check-label" for="winery-{{bodega}}">
                    {{ bodega }}
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Contenido Principal de Productos -->
        <div class="col-lg-9">
          <!-- Información de resultados -->
          <div class="results-info">
            <p class="mb-0">{{ productosFiltrados.length }} productos encontrados</p>
          </div>

          <!-- Estado de carga -->
          <div *ngIf="loading" class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Cargando...</span>
            </div>
            <p class="mt-3">Cargando productos...</p>
          </div>

          <!-- Grid de Productos -->
          <div *ngIf="!loading" class="row g-4">
            <div *ngFor="let producto of productosPaginados" class="col-sm-6 col-md-4 col-xl-3">
              <div class="card product-card h-100">
                <!-- Badge de oferta -->
                <div *ngIf="producto.enOferta" class="product-badge">
                  <span class="badge bg-danger">-{{ calcularDescuento(producto) }}%</span>
                </div>

                <div class="product-image">
                  <img [src]="producto.imagenUrl"
                       [alt]="producto.nombre"
                       class="product-img">
                  <div class="product-actions">
                    <button class="btn-action btn-favorite">
                      <i class="far fa-heart"></i>
                    </button>
                    <button class="btn-action btn-view">
                      <i class="far fa-eye"></i>
                    </button>
                  </div>
                </div>

                <div class="card-body product-content d-flex flex-column">
                  <div class="product-category">{{ producto.categoria }}</div>
                  <h3 class="product-name">{{ producto.nombre }}</h3>

                  <!-- Calificación con estrellas -->
                  <div class="product-rating">
                    <div class="rating-stars">
                      <span *ngFor="let star of generarEstrellas(producto.calificacion)">
                        <i class="fas fa-star" *ngIf="star === 1"></i>
                        <i class="far fa-star" *ngIf="star === 0"></i>
                      </span>
                    </div>
                    <span class="rating-value">({{ producto.calificacion }}.0)</span>
                  </div>

                  <div class="product-bodega">{{ producto.bodega || producto.marca }}</div>

                  <div class="product-pricing">
                    <span class="product-price">S/ {{ producto.precio | number:'1.2-2' }}</span>
                    <span *ngIf="producto.precioOriginal" class="product-price-original">
                      S/ {{ producto.precioOriginal | number:'1.2-2' }}
                    </span>
                  </div>

                  <div class="product-stock mt-auto"
                       [class.stock-available]="producto.stock > 10"
                       [class.stock-low]="producto.stock <= 10 && producto.stock > 0"
                       [class.stock-unavailable]="producto.stock === 0">
                    {{ producto.stock > 0 ? (producto.stock < 10 ? 'Últimas unidades' : 'En stock') : 'Agotado' }}
                  </div>

                  <button class="btn btn-add-cart mt-2" [disabled]="producto.stock === 0">
                    <i class="fas fa-shopping-cart"></i>
                    Añadir al Carrito
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Paginación -->
          <div *ngIf="!loading && totalPaginas > 1" class="pagination-container">
            <nav aria-label="Page navigation">
              <ul class="pagination justify-content-center">
                <li class="page-item" [class.disabled]="paginaActual === 1">
                  <a class="page-link" (click)="cambiarPagina(paginaActual - 1)" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                  </a>
                </li>

                <li *ngFor="let pagina of [].constructor(totalPaginas); let i = index"
                    class="page-item"
                    [class.active]="paginaActual === i + 1">
                  <a class="page-link" (click)="cambiarPagina(i + 1)">{{ i + 1 }}</a>
                </li>

                <li class="page-item" [class.disabled]="paginaActual === totalPaginas">
                  <a class="page-link" (click)="cambiarPagina(paginaActual + 1)" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                  </a>
                </li>
              </ul>
            </nav>
          </div>

          <!-- Sin resultados -->
          <div *ngIf="!loading && productosFiltrados.length === 0" class="no-results">
            <i class="fas fa-search fa-4x text-muted mb-3"></i>
            <h3>No se encontraron productos</h3>
            <p>Intenta ajustar los filtros para ver más resultados.</p>
            <button class="btn btn-clear-filters" (click)="limpiarFiltros()">
              Mostrar todos los productos
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>
